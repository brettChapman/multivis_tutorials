        
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <style> 

        body {
            background-color: white;            
        }

        .links line {
            stroke-opacity: 0.6;
        }

        .nodes circle {
            stroke: #fff;
            stroke-width: 1.5px;
            opacity: 1.0;
        }

        .text {
            stroke: #fff;
            stroke-width: 1.5px;
            opacity: 1.0;
        }
        
        #nodeSizeDropdown {
            position: relative;
            top: 25px;
        }

        #nodeColorDropdown {
            position: relative;
            top: 30px;
        }

        #sliderText {
            position: absolute;
            top: 59px;
            left: 0px;
            color: 'black';
        }

        #slider {
            position: absolute;
            top: 40px;
            left: 125px;
        }

        #sliderValue {
            position: absolute;
            top: 60px;
            left: 350px;
            color: 'black';
        }

        #save {
            position: relative;
            top: 35px;
            left: 0px;                 
        }  

        #springPanel {
            position: relative;
            height: 500px;
            margin: 0 auto;
            margin-top: auto;
            margin-bottom: auto;
            margin-left: auto;
            margin-right: auto;
        }

        #sliderValue, text {

            font-family: sans-serif;
                -webkit-touch-callout: none; /* iOS Safari */
                -webkit-user-select: none; /* Safari */
                -khtml-user-select: none; /* Konqueror HTML */
                -moz-user-select: none; /* Firefox */
                -ms-user-select: none; /* Internet Explorer/Edge */
                user-select: none; /* Non-prefixed version, currently supported by Chrome and Opera */
        }
        
        td:nth-child(odd) {
            background-color: #eee;
            font-weight: bold;
        }
         </style>
        
        <head>
	        <meta charset="utf-8">
	        <meta http-equiv="X-UA-Compatible" content="IE=edge">
	        <meta name="viewport" content="width=device-width, initial-scale=1.0">
	        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css">
        </head>
        
        <body ng-app="firstApplication">
	        <div class="container-fluid py-5">
		        <div class="row" ng-controller="sliderController as ctrl">
			        <div class="col-lg-9 col-12">
				        <div class="row">					
					        <div class="col-lg-6 col-12 mb-3">
						        <div class="card">
							        <div class="card-header">
								        <h4>Spring-embedded network</h4>
							        </div>
							        <div class="card-body">
								        <div id="springPanel"></div>
							        </div>
						        </div>
					        </div>
					        <div class="col-lg-6 col-12 mb-3">
						        <div class="card">
							        <div class="card-header">
								        <h4>Node Data</h4>
							        </div>
							        <div class="card-body">
								        <div id="nodedataPanel"></div>
							        </div>
						        </div>
					        </div>
				        </div>		
			        </div>

                    <div class="col-lg-3 col-12 mb-3">
				        <div class="card mb-3" style="min-width: 28rem; max-width: 28rem; min-height: 14rem;">							
				            <div id='sliderPanel' class="card-body p-3">								
                                <form id="search" whitespace="nowrap"></form>                        
                                <h6 id="sliderText" class='ml-3'></h6>
                                <div id="slider"></div>
                                <h6><span style="white-space: nowrap;" id="sliderValue"></span></h6>                             
                                <div id="nodeSizeDropdown"></div>                                        
                                <div id="nodeColorDropdown"></div>                        
                                <button id='save'>Save</button>                                
                            <div>
                        </div>
			        </div>
                </div>
            </div>            
        </body>
        
        <script src="https://d3js.org/d3.v5.min.js"></script>
        <script src="https://unpkg.com/d3-simple-slider"></script>
        <script src="https://github.com/canvg/canvg/blob/master/src/canvg.js"></script>
        <script src="https://exupero.org/saveSvgAsPng/src/saveSvgAsPng.js"></script>
        
        <script> 

        var params = JSON.parse(JSON.stringify({'link_type': 'score', 'link_width': 0.5, 'node_text_size': 15, 'displayLabel': 'true', 'node_data': ['Name', 'Label', 'Mode', 'mz', 'rt', 'F', 'pvalue', 'pFDR', 'RSD', 'Dratio'], 'node_size_scale': {'pvalue': {'scale': 'reverse_linear', 'range': [5, 30]}, 'pFDR': {'scale': 'reverse_linear', 'range': [10, 30]}, 'F': {'scale': 'log', 'range': [10, 50]}, 'RSD': {'scale': 'reverse_log', 'range': [5, 20]}, 'Dratio': {'scale': 'log', 'range': [5, 20]}}, 'chargeStrength': -120, 'fix_nodes': 'true'}));

        var networkData = "{\"nodes\": [{\"id\": 0, \"Idx\": \"1\", \"Name\": \"M1\", \"Label\": \"Ocatanedioic acid\", \"Mode\": \"Negative\", \"mz\": \"173.0814936\", \"rt\": \"528.593\", \"F\": \"1.20580499949928\", \"pvalue\": \"0.316809429654668\", \"pFDR\": \"0.290528592310766\", \"RSD\": \"10.4712294328065\", \"Dratio\": \"2.8872207484304\", \"color\": \"#4daf4a\"}, {\"id\": 2, \"Idx\": \"3\", \"Name\": \"M3\", \"Label\": \"Dodecanedioc acid\", \"Mode\": \"Negative\", \"mz\": \"229.143848\", \"rt\": \"966.471\", \"F\": \"3.65988782518355\", \"pvalue\": \"0.0790391935278154\", \"pFDR\": \"0.191245625859604\", \"RSD\": \"19.8564515336576\", \"Dratio\": \"3.21674171536072\", \"color\": \"#e41a1c\"}, {\"id\": 7, \"Idx\": \"8\", \"Name\": \"M8\", \"Label\": \"Glycocholic acid\", \"Mode\": \"Negative\", \"mz\": \"464.2996324\", \"rt\": \"979.16\", \"F\": \"7.62627977928109\", \"pvalue\": \"0.0055561816777377\", \"pFDR\": \"0.0760327539927116\", \"RSD\": \"11.9023111972631\", \"Dratio\": \"7.4631773966264\", \"color\": \"#e41a1c\"}, {\"id\": 8, \"Idx\": \"9\", \"Name\": \"M9\", \"Label\": \"L-Tryptophan\", \"Mode\": \"Negative\", \"mz\": \"203.0821552\", \"rt\": \"337.889\", \"F\": \"1.33582291749258\", \"pvalue\": \"0.287394237048956\", \"pFDR\": \"0.284527643984525\", \"RSD\": \"4.28942262139224\", \"Dratio\": \"3.48064971062249\", \"color\": \"#4daf4a\"}, {\"id\": 9, \"Idx\": \"10\", \"Name\": \"M10\", \"Label\": \"Hexadecanedioic acid\", \"Mode\": \"Negative\", \"mz\": \"285.2057299\", \"rt\": \"1344.61\", \"F\": \"0.554781791967447\", \"pvalue\": \"0.543472507847197\", \"pFDR\": \"0.328266939980167\", \"RSD\": \"9.53718839791506\", \"Dratio\": \"4.94217218241756\", \"color\": \"#ffff33\"}, {\"id\": 10, \"Idx\": \"11\", \"Name\": \"M11\", \"Label\": \"Pseudouridine\", \"Mode\": \"Negative\", \"mz\": \"243.0612565\", \"rt\": \"85.364\", \"F\": \"1.6435444299445\", \"pvalue\": \"0.221582868255957\", \"pFDR\": \"0.264951112801882\", \"RSD\": \"3.20575216891402\", \"Dratio\": \"5.19485252302597\", \"color\": \"#4daf4a\"}, {\"id\": 24, \"Idx\": \"25\", \"Name\": \"M25\", \"Label\": \"Phenylalanine\", \"Mode\": \"Positive\", \"mz\": \"166.0867342\", \"rt\": \"282.6595\", \"F\": \"2.25529291656826\", \"pvalue\": \"0.13912098916702\", \"pFDR\": \"0.234071408622749\", \"RSD\": \"5.50620215040509\", \"Dratio\": \"4.749588166799\", \"color\": \"#377eb8\"}, {\"id\": 1, \"Idx\": \"2\", \"Name\": \"M2\", \"Label\": \"Glycoursodeoxycholic acid\", \"Mode\": \"Negative\", \"mz\": \"448.3048795\", \"rt\": \"1158.75\", \"F\": \"6.6741169557049\", \"pvalue\": \"0.00738194291064731\", \"pFDR\": \"0.0797503547732716\", \"RSD\": \"4.70683906005692\", \"Dratio\": \"24.3148629492232\", \"color\": \"#e41a1c\"}, {\"id\": 5, \"Idx\": \"6\", \"Name\": \"M6\", \"Label\": \"Lactic Acid\", \"Mode\": \"Negative\", \"mz\": \"89.02512203\", \"rt\": \"84.363\", \"F\": \"4.92863410270874\", \"pvalue\": \"0.020552209789679\", \"pFDR\": \"0.111017251280658\", \"RSD\": \"10.3418071336858\", \"Dratio\": \"2.33253381281317\", \"color\": \"#e41a1c\"}, {\"id\": 12, \"Idx\": \"13\", \"Name\": \"M13\", \"Label\": \"L-Tyrosine\", \"Mode\": \"Negative\", \"mz\": \"180.0662313\", \"rt\": \"147.197\", \"F\": \"5.99178957598754\", \"pvalue\": \"0.0166447400985999\", \"pFDR\": \"0.107327359243358\", \"RSD\": \"9.40973021335313\", \"Dratio\": \"3.26851257085017\", \"color\": \"#e41a1c\"}, {\"id\": 25, \"Idx\": \"26\", \"Name\": \"M26\", \"Label\": \"Adenosine\", \"Mode\": \"Positive\", \"mz\": \"268.1044997\", \"rt\": \"234.219\", \"F\": \"8.87246686536154\", \"pvalue\": \"0.00218763259640172\", \"pFDR\": \"0.0549851100616676\", \"RSD\": \"8.1534965929558\", \"Dratio\": \"9.30871395831041\", \"color\": \"#e41a1c\"}, {\"id\": 19, \"Idx\": \"20\", \"Name\": \"M20\", \"Label\": \"L-Proline\", \"Mode\": \"Positive\", \"mz\": \"116.0716384\", \"rt\": \"56.656\", \"F\": \"6.9497544268455\", \"pvalue\": \"0.0113572429929878\", \"pFDR\": \"0.0896633812508486\", \"RSD\": \"5.94164179117505\", \"Dratio\": \"6.73931526213702\", \"color\": \"#e41a1c\"}, {\"id\": 30, \"Idx\": \"31\", \"Name\": \"M31\", \"Label\": \"Tetradecanedioc acid\", \"Mode\": \"Positive\", \"mz\": \"520.3400103\", \"rt\": \"1436.77\", \"F\": \"2.28272289102931\", \"pvalue\": \"0.157126086204619\", \"pFDR\": \"0.239202968102066\", \"RSD\": \"16.4525760572793\", \"Dratio\": \"2.1451117209936\", \"color\": \"#377eb8\"}, {\"id\": 3, \"Idx\": \"4\", \"Name\": \"M4\", \"Label\": \"Succinic Acid\", \"Mode\": \"Negative\", \"mz\": \"117.0193225\", \"rt\": \"133.4985\", \"F\": \"0.415028135103856\", \"pvalue\": \"0.626102281483585\", \"pFDR\": \"0.341497981950194\", \"RSD\": \"5.57758173557696\", \"Dratio\": \"4.02560182591193\", \"color\": \"#ffff33\"}, {\"id\": 4, \"Idx\": \"5\", \"Name\": \"M5\", \"Label\": \"Citric Acid\", \"Mode\": \"Negative\", \"mz\": \"191.019367\", \"rt\": \"109.544\", \"F\": \"0.741641380659948\", \"pvalue\": \"0.43526594776887\", \"pFDR\": \"0.311668591419043\", \"RSD\": \"9.17087428507904\", \"Dratio\": \"2.41711519436577\", \"color\": \"#ff7f00\"}, {\"id\": 22, \"Idx\": \"23\", \"Name\": \"M23\", \"Label\": \"Tiglylcarnitine\", \"Mode\": \"Positive\", \"mz\": \"244.1547025\", \"rt\": \"377.654\", \"F\": \"5.59387431237903\", \"pvalue\": \"0.0147709507601346\", \"pFDR\": \"0.102201022523215\", \"RSD\": \"11.3892447497005\", \"Dratio\": \"3.26334888333282\", \"color\": \"#e41a1c\"}, {\"id\": 26, \"Idx\": \"27\", \"Name\": \"M27\", \"Label\": \"2-Octenoylcarnitine\", \"Mode\": \"Positive\", \"mz\": \"286.2015687\", \"rt\": \"733.323\", \"F\": \"3.25899622958699\", \"pvalue\": \"0.0691691202928987\", \"pFDR\": \"0.181637787173238\", \"RSD\": \"5.09172697780684\", \"Dratio\": \"12.793497260172\", \"color\": \"#e41a1c\"}, {\"id\": 17, \"Idx\": \"18\", \"Name\": \"M18\", \"Label\": \"N-Phenylacetylglutamine\", \"Mode\": \"Positive\", \"mz\": \"265.1185383\", \"rt\": \"431.609\", \"F\": \"1.7535246837068\", \"pvalue\": \"0.2105977111565\", \"pFDR\": \"0.26252066462609\", \"RSD\": \"11.5769623523093\", \"Dratio\": \"4.59639777382069\", \"color\": \"#377eb8\"}, {\"id\": 6, \"Idx\": \"7\", \"Name\": \"M7\", \"Label\": \"5-Hydroxytryptophan\", \"Mode\": \"Negative\", \"mz\": \"219.0768091\", \"rt\": \"217.493\", \"F\": \"1.25429929524897\", \"pvalue\": \"0.303982625217717\", \"pFDR\": \"0.286883151078054\", \"RSD\": \"16.8767206661306\", \"Dratio\": \"1.56437420232442\", \"color\": \"#4daf4a\"}, {\"id\": 14, \"Idx\": \"15\", \"Name\": \"M15\", \"Label\": \"L-kynurenine\", \"Mode\": \"Positive\", \"mz\": \"209.0927368\", \"rt\": \"276.984\", \"F\": \"0.319247535317545\", \"pvalue\": \"0.692310492334444\", \"pFDR\": \"0.350593722698766\", \"RSD\": \"5.17865186714287\", \"Dratio\": \"5.65052021106375\", \"color\": \"#a65628\"}, {\"id\": 15, \"Idx\": \"16\", \"Name\": \"M16\", \"Label\": \"5-methoxyindole acetic acid\", \"Mode\": \"Positive\", \"mz\": \"206.081515\", \"rt\": \"571.1215\", \"F\": \"0.709517138467766\", \"pvalue\": \"0.48625231217395\", \"pFDR\": \"0.317531477283698\", \"RSD\": \"9.41871509843643\", \"Dratio\": \"3.11389510574256\", \"color\": \"#ff7f00\"}, {\"id\": 20, \"Idx\": \"21\", \"Name\": \"M21\", \"Label\": \"Indole-3-acetic acid\", \"Mode\": \"Positive\", \"mz\": \"176.0711015\", \"rt\": \"645.97\", \"F\": \"0.0122606069327192\", \"pvalue\": \"0.975768069413858\", \"pFDR\": \"0.405038073655443\", \"RSD\": \"7.19041618128093\", \"Dratio\": \"4.63330305499193\", \"color\": \"#999999\"}, {\"id\": 28, \"Idx\": \"29\", \"Name\": \"M29\", \"Label\": \"Cortisol \", \"Mode\": \"Positive\", \"mz\": \"363.217288\", \"rt\": \"779.069\", \"F\": \"3.83166105052219\", \"pvalue\": \"0.0478722499051548\", \"pFDR\": \"0.167497360787185\", \"RSD\": \"4.94256748210212\", \"Dratio\": \"10.4163145783544\", \"color\": \"#e41a1c\"}, {\"id\": 18, \"Idx\": \"19\", \"Name\": \"M19\", \"Label\": \"L-Methionine\", \"Mode\": \"Positive\", \"mz\": \"150.0587442\", \"rt\": \"91.824\", \"F\": \"3.53514377309872\", \"pvalue\": \"0.0626089680675837\", \"pFDR\": \"0.178492343562938\", \"RSD\": \"8.64583168129658\", \"Dratio\": \"3.89815801526016\", \"color\": \"#e41a1c\"}, {\"id\": 11, \"Idx\": \"12\", \"Name\": \"M12\", \"Label\": \"Uric acid\", \"Mode\": \"Negative\", \"mz\": \"335.0480195\", \"rt\": \"94.622\", \"F\": \"1.81229025915499\", \"pvalue\": \"0.19267708311762\", \"pFDR\": \"0.254613216625571\", \"RSD\": \"4.05003744537164\", \"Dratio\": \"3.41003186997637\", \"color\": \"#377eb8\"}, {\"id\": 21, \"Idx\": \"22\", \"Name\": \"M22\", \"Label\": \"N-Acetyl-L-Carnosine\", \"Mode\": \"Positive\", \"mz\": \"269.1244755\", \"rt\": \"86.4285\", \"F\": \"1.38601671741523\", \"pvalue\": \"0.275898715204706\", \"pFDR\": \"0.279896703904986\", \"RSD\": \"16.1867420693445\", \"Dratio\": \"2.74485776155857\", \"color\": \"#4daf4a\"}, {\"id\": 16, \"Idx\": \"17\", \"Name\": \"M17\", \"Label\": \"Linoleic acida\", \"Mode\": \"Positive\", \"mz\": \"281.2480499\", \"rt\": \"1874.25\", \"F\": \"2.4896267766394\", \"pvalue\": \"0.112329435663305\", \"pFDR\": \"0.217522033318334\", \"RSD\": \"14.1852213838824\", \"Dratio\": \"3.77599733726548\", \"color\": \"#377eb8\"}, {\"id\": 31, \"Idx\": \"32\", \"Name\": \"M32\", \"Label\": \"Bilirubin\", \"Mode\": \"Positive\", \"mz\": \"585.2705643\", \"rt\": \"2059.93\", \"F\": \"10.7952965941857\", \"pvalue\": \"0.00197127360314567\", \"pFDR\": \"0.053951209522482\", \"RSD\": \"12.0698594478432\", \"Dratio\": \"4.47565519524638\", \"color\": \"#e41a1c\"}, {\"id\": 13, \"Idx\": \"14\", \"Name\": \"M14\", \"Label\": \"Hypoxanthine\", \"Mode\": \"Positive\", \"mz\": \"137.0463946\", \"rt\": \"100.593\", \"F\": \"3.31714245291838\", \"pvalue\": \"0.0618275109477684\", \"pFDR\": \"0.177911813619459\", \"RSD\": \"4.13574593254638\", \"Dratio\": \"7.85418774439855\", \"color\": \"#e41a1c\"}, {\"id\": 23, \"Idx\": \"24\", \"Name\": \"M24\", \"Label\": \"cis-Aconitic acid\", \"Mode\": \"Positive\", \"mz\": \"175.0241655\", \"rt\": \"108.0405\", \"F\": \"0.597833901234562\", \"pvalue\": \"0.499568785381846\", \"pFDR\": \"0.320784580564316\", \"RSD\": \"19.0264380635713\", \"Dratio\": \"1.73876227280005\", \"color\": \"#ff7f00\"}], \"links\": [{\"source\": 0, \"target\": 2, \"weight\": 0.4547697002026427, \"color\": \"red\"}, {\"source\": 0, \"target\": 7, \"weight\": 0.4235313258316822, \"color\": \"red\"}, {\"source\": 0, \"target\": 8, \"weight\": 0.4434955315557379, \"color\": \"red\"}, {\"source\": 0, \"target\": 9, \"weight\": 0.42419323920509455, \"color\": \"red\"}, {\"source\": 0, \"target\": 10, \"weight\": 0.40350481850693465, \"color\": \"red\"}, {\"source\": 0, \"target\": 24, \"weight\": 0.42686240365623795, \"color\": \"red\"}, {\"source\": 2, \"target\": 5, \"weight\": 0.4004522251911742, \"color\": \"red\"}, {\"source\": 2, \"target\": 7, \"weight\": 0.4844641572289073, \"color\": \"red\"}, {\"source\": 2, \"target\": 9, \"weight\": 0.5011960761652083, \"color\": \"red\"}, {\"source\": 2, \"target\": 19, \"weight\": 0.5025890733996604, \"color\": \"red\"}, {\"source\": 2, \"target\": 30, \"weight\": 0.44546249946491373, \"color\": \"red\"}, {\"source\": 7, \"target\": 5, \"weight\": 0.44966091576957695, \"color\": \"red\"}, {\"source\": 7, \"target\": 8, \"weight\": 0.5522804561236638, \"color\": \"red\"}, {\"source\": 7, \"target\": 9, \"weight\": 0.37095937942009927, \"color\": \"red\"}, {\"source\": 7, \"target\": 12, \"weight\": 0.6731023566843768, \"color\": \"red\"}, {\"source\": 7, \"target\": 18, \"weight\": 0.7460030363167851, \"color\": \"red\"}, {\"source\": 7, \"target\": 19, \"weight\": 0.7097283501217914, \"color\": \"red\"}, {\"source\": 7, \"target\": 24, \"weight\": 0.5118494073341066, \"color\": \"red\"}, {\"source\": 7, \"target\": 25, \"weight\": 0.4115540959200865, \"color\": \"red\"}, {\"source\": 7, \"target\": 30, \"weight\": 0.40074659764667964, \"color\": \"red\"}, {\"source\": 8, \"target\": 10, \"weight\": 0.40246807986109856, \"color\": \"red\"}, {\"source\": 8, \"target\": 12, \"weight\": 0.7775873336501062, \"color\": \"red\"}, {\"source\": 8, \"target\": 18, \"weight\": 0.5846687758683451, \"color\": \"red\"}, {\"source\": 8, \"target\": 24, \"weight\": 0.5841535531341525, \"color\": \"red\"}, {\"source\": 9, \"target\": 10, \"weight\": 0.48581436038909925, \"color\": \"red\"}, {\"source\": 9, \"target\": 11, \"weight\": 0.3434068387242718, \"color\": \"red\"}, {\"source\": 9, \"target\": 14, \"weight\": 0.33444702777288016, \"color\": \"red\"}, {\"source\": 9, \"target\": 15, \"weight\": 0.3412666757084098, \"color\": \"red\"}, {\"source\": 9, \"target\": 19, \"weight\": 0.408384070930546, \"color\": \"red\"}, {\"source\": 9, \"target\": 21, \"weight\": 0.3475876631972028, \"color\": \"red\"}, {\"source\": 10, \"target\": 3, \"weight\": 0.38240386705184826, \"color\": \"red\"}, {\"source\": 10, \"target\": 4, \"weight\": 0.35632616337210815, \"color\": \"red\"}, {\"source\": 10, \"target\": 16, \"weight\": 0.3369848187409419, \"color\": \"red\"}, {\"source\": 10, \"target\": 24, \"weight\": 0.35563707106340586, \"color\": \"red\"}, {\"source\": 24, \"target\": 1, \"weight\": 0.3178771023277117, \"color\": \"red\"}, {\"source\": 24, \"target\": 12, \"weight\": 0.5007293873922372, \"color\": \"red\"}, {\"source\": 24, \"target\": 18, \"weight\": 0.4481244060423967, \"color\": \"red\"}, {\"source\": 24, \"target\": 19, \"weight\": 0.34738316355877474, \"color\": \"red\"}, {\"source\": 1, \"target\": 5, \"weight\": 0.40990437326781093, \"color\": \"red\"}, {\"source\": 1, \"target\": 12, \"weight\": 0.31878620785475803, \"color\": \"red\"}, {\"source\": 1, \"target\": 25, \"weight\": 0.3740907406749846, \"color\": \"red\"}, {\"source\": 5, \"target\": 19, \"weight\": 0.44668311928473703, \"color\": \"red\"}, {\"source\": 5, \"target\": 25, \"weight\": 0.4483867913163057, \"color\": \"red\"}, {\"source\": 5, \"target\": 30, \"weight\": 0.3126120956104148, \"color\": \"red\"}, {\"source\": 12, \"target\": 18, \"weight\": 0.7635537711364857, \"color\": \"red\"}, {\"source\": 12, \"target\": 19, \"weight\": 0.5123988131056694, \"color\": \"red\"}, {\"source\": 12, \"target\": 25, \"weight\": 0.31288425365666284, \"color\": \"red\"}, {\"source\": 12, \"target\": 30, \"weight\": 0.34367788062517207, \"color\": \"red\"}, {\"source\": 19, \"target\": 14, \"weight\": 0.3627230153583134, \"color\": \"red\"}, {\"source\": 19, \"target\": 18, \"weight\": 0.5925609131198953, \"color\": \"red\"}, {\"source\": 19, \"target\": 21, \"weight\": 0.5069514971279656, \"color\": \"red\"}, {\"source\": 19, \"target\": 30, \"weight\": 0.6313914849805888, \"color\": \"red\"}, {\"source\": 30, \"target\": 21, \"weight\": 0.43776815487022946, \"color\": \"red\"}, {\"source\": 30, \"target\": 23, \"weight\": 0.3160133483961805, \"color\": \"red\"}, {\"source\": 3, \"target\": 4, \"weight\": 0.37586115947373133, \"color\": \"red\"}, {\"source\": 3, \"target\": 22, \"weight\": 0.4319658241625961, \"color\": \"red\"}, {\"source\": 3, \"target\": 26, \"weight\": 0.4319741374971302, \"color\": \"red\"}, {\"source\": 4, \"target\": 17, \"weight\": 0.4324354874558965, \"color\": \"red\"}, {\"source\": 22, \"target\": 11, \"weight\": 0.5037010307246242, \"color\": \"red\"}, {\"source\": 22, \"target\": 14, \"weight\": 0.3283530572299838, \"color\": \"red\"}, {\"source\": 22, \"target\": 15, \"weight\": 0.571753662952238, \"color\": \"red\"}, {\"source\": 22, \"target\": 17, \"weight\": 0.4102762372353547, \"color\": \"red\"}, {\"source\": 22, \"target\": 26, \"weight\": 0.5300819528805065, \"color\": \"red\"}, {\"source\": 22, \"target\": 28, \"weight\": 0.6256012559834364, \"color\": \"red\"}, {\"source\": 26, \"target\": 16, \"weight\": 0.5813054743897101, \"color\": \"red\"}, {\"source\": 26, \"target\": 17, \"weight\": 0.5463646224376507, \"color\": \"red\"}, {\"source\": 26, \"target\": 28, \"weight\": 0.48534288021584326, \"color\": \"red\"}, {\"source\": 17, \"target\": 20, \"weight\": 0.5047208256566542, \"color\": \"red\"}, {\"source\": 17, \"target\": 28, \"weight\": 0.6551557826074689, \"color\": \"red\"}, {\"source\": 6, \"target\": 14, \"weight\": 0.5056415820297622, \"color\": \"red\"}, {\"source\": 6, \"target\": 15, \"weight\": 0.46228685355151217, \"color\": \"red\"}, {\"source\": 6, \"target\": 20, \"weight\": 0.4225659695114665, \"color\": \"red\"}, {\"source\": 6, \"target\": 28, \"weight\": 0.36601780086358604, \"color\": \"red\"}, {\"source\": 14, \"target\": 13, \"weight\": 0.31353862201792404, \"color\": \"red\"}, {\"source\": 14, \"target\": 15, \"weight\": 0.5514863476047512, \"color\": \"red\"}, {\"source\": 14, \"target\": 18, \"weight\": 0.3257725051123931, \"color\": \"red\"}, {\"source\": 14, \"target\": 21, \"weight\": 0.5166947211245551, \"color\": \"red\"}, {\"source\": 15, \"target\": 11, \"weight\": 0.578625436655811, \"color\": \"red\"}, {\"source\": 15, \"target\": 21, \"weight\": 0.39577579053489714, \"color\": \"red\"}, {\"source\": 20, \"target\": 28, \"weight\": 0.5452977767028065, \"color\": \"red\"}, {\"source\": 11, \"target\": 21, \"weight\": 0.4606125864723005, \"color\": \"red\"}, {\"source\": 11, \"target\": 31, \"weight\": 0.33560635986919357, \"color\": \"red\"}, {\"source\": 21, \"target\": 23, \"weight\": 0.38703990088106976, \"color\": \"red\"}]}"

        var canvas = document.getElementById("springPanel");
        var springNetwork = d3.select(canvas).append("svg").attr("id", "springNetwork");

        function redraw(){

            d3.select('#sliderPanel').select("#search").selectAll("*").remove();            
            d3.select('#sliderPanel').select("#nodeSizeDropdown").selectAll("*").remove();
            d3.select('#sliderPanel').select("#nodeColorDropdown").selectAll("*").remove();
            d3.select('#sliderPanel').select("#save").selectAll("*").remove();

            var colorBy = [];

            var width = canvas.clientWidth;
            var height = canvas.clientHeight;

            springNetwork.selectAll("*").remove();
            
            var svg = d3.select("svg#springNetwork")
                                .attr("width", width)
                                .attr("height", height);

            svg.call(d3.zoom().on('zoom', zoomed))
                .on("dblclick.zoom", null);

            var simulation = d3.forceSimulation()
                .force("link", d3.forceLink().id(d => d.id))            
                .force("center", d3.forceCenter(width / 2, height / 2));        

            var container = svg.append('g');

            var search = d3.select("#search").attr('onsubmit', 'return false;');

            var box = search.append('input')
                .attr('type', 'text')
                .attr('id', 'searchTerm')
                .attr('placeholder', 'Type to search...');

            var button = search.append('input')
                .attr('type', 'button')
                .attr('value', 'Search')
                .on('click', function () { searchNodes(); });

            var toggle = 0;
            
            var graph = JSON.parse(networkData);

            if (params.link_type == "score") {            
                var link_type_text = "Score";
            } else if (params.link_type == "pvalue") {
                var link_type_text = "Pvalue";
            }

            var graphRec = JSON.parse(JSON.stringify(graph));

            var link = container.append("g")
                .attr("class", "links")
                .selectAll("line");

            var node = container.append("g")
                .attr("class", "nodes")
                .selectAll("circle");

            var label = container.selectAll(".text");

            var linkedByIndex = {};

            graphRec.links.forEach( function(d) {
                linkedByIndex[d.source + ',' + d.target] = 1;
                linkedByIndex[d.target + ',' + d.source] = 1;
            });

            if (Object.keys(params.node_size_scale).length === 0) {

                graph.nodes.forEach( function (d) { d.size = 10; });

            } else {

                updateNodeSize(Object.keys(params.node_size_scale)[0])
            }

            function updateNodeSize(centrality) {

                var scaleType = params.node_size_scale[centrality].scale
                var range = params.node_size_scale[centrality].range

                var centrality_values = []        
                graph.nodes.forEach( function (d) { if (isNaN(d[centrality])) { centrality_values.push(parseFloat(0)); } else { centrality_values.push(parseFloat(d[centrality])); }});

                initScale = d3.scaleLinear()
                    .domain(d3.extent(centrality_values))
                    .range([1,10]);

                scaledValues = []
                centrality_values.forEach( function (d) { scaledValues.push(initScale(parseFloat(d))); });

                if (scaleType == "linear") {

                    linearScale = d3.scaleLinear()
                         .domain(d3.extent(scaledValues))
                         .range(range);

                    graph.nodes.forEach( function (d) { if (isNaN(d[centrality])) { d.size = linearScale(initScale(parseFloat(0))); } else { d.size = linearScale(initScale(parseFloat(d[centrality]))); }});

                } else if (scaleType == "reverse_linear") {

                    reversed_linear_values = []

                    scaledValues.forEach( function (d) { reversed_linear_values.push(parseFloat(1/d)); });

                    reversedLinearScale = d3.scaleLinear()
                        .domain(d3.extent(reversed_linear_values))
                        .range(range);

                    graph.nodes.forEach( function (d) { if (isNaN(d[centrality])) { d.size = reversedLinearScale(1 / initScale(parseFloat(0))); } else { d.size = reversedLinearScale(1 / initScale(parseFloat(d[centrality]))); }});

                } else if (scaleType == "log") {

                    logScale = d3.scaleLog()
                        .domain(d3.extent(scaledValues))
                        .range(range);  	        

                    graph.nodes.forEach( function (d) { if (isNaN(d[centrality])) { d.size = logScale(initScale(parseFloat(0))); } else { d.size = logScale(initScale(parseFloat(d[centrality]))); }});

                } else if (scaleType == "reverse_log") {

                    reversed_log_values = []

                    scaledValues.forEach( function (d) { reversed_log_values.push(parseFloat(1/d)); });

                    reversedLogScale = d3.scaleLog()
                        .domain(d3.extent(reversed_log_values))
                        .range(range);

                    graph.nodes.forEach( function (d) { if (isNaN(d[centrality])) { d.size = reversedLogScale(1 / initScale(parseFloat(0))); } else { d.size = reversedLogScale(1 / initScale(parseFloat(d[centrality]))); }});

                } else if (scaleType == "square") {

                    squareScale = d3.scalePow()
                        .domain(d3.extent(scaledValues))
                        .exponent(2)
                        .range(range);

                    graph.nodes.forEach( function (d) { if (isNaN(d[centrality])) { d.size = squareScale(initScale(parseFloat(0))); } else { d.size = squareScale(initScale(parseFloat(d[centrality]))); }});

                } else if (scaleType == "reverse_square") {

                    reversed_squared_values = []

                    scaledValues.forEach( function (d) { reversed_squared_values.push(parseFloat(1/d)); });

                    reversedSquareScale = d3.scalePow()
                        .domain(d3.extent(reversed_squared_values))
                        .exponent(2)
                        .range(range);

                    graph.nodes.forEach( function (d) { if (isNaN(d[centrality])) { d.size = reversedSquareScale(1 / initScale(parseFloat(0))); } else { d.size = reversedSquareScale(1 / initScale(parseFloat(d[centrality]))); }});

                } else if (scaleType == "area") {

                    area_values = []

                    scaledValues.forEach( function (d) { area_values.push(parseFloat(Math.PI * (d * d))); });

                    areaScale = d3.scaleLinear()
                        .domain(d3.extent(area_values))
                        .range(range);

                    graph.nodes.forEach( function (d) { if (isNaN(d[centrality])) { d.size = areaScale(Math.PI * (initScale(parseFloat(0)) * initScale(parseFloat(0)))); } else { d.size = areaScale(Math.PI * (initScale(parseFloat(d[centrality])) * initScale(parseFloat(d[centrality])))); }});

                } else if (scaleType == "reverse_area") {

                    reversed_area_values = []

                    scaledValues.forEach( function (d) { reversed_area_values.push(parseFloat(Math.PI * (parseFloat(1/d) * parseFloat(1/d)))); });

                    reversedAreaScale = d3.scaleLinear()
                        .domain(d3.extent(reversed_area_values))
                        .range(range);

                    graph.nodes.forEach( function (d) { if (isNaN(d[centrality])) { d.size = reversedAreaScale(Math.PI * (1 / initScale(parseFloat(0))) * (1 / initScale(parseFloat(0)))); } else { d.size = reversedAreaScale(Math.PI * (1 / initScale(parseFloat(d[centrality]))) * (1 / initScale(parseFloat(d[centrality])))); }});

                } else if (scaleType == "volume") {

                    volume_values = []

                    scaledValues.forEach( function (d) { volume_values.push(parseFloat(4 / 3 * (Math.PI * (d * d * d)))); });

                    volumeScale = d3.scaleLinear()
                        .domain(d3.extent(volume_values))
                        .range(range);

                    graph.nodes.forEach( function (d) { if (isNaN(d[centrality])) { d.size = volumeScale(4 / 3 * (Math.PI * (initScale(parseFloat(0)) * initScale(parseFloat(0)) * initScale(parseFloat(0))))); } else { d.size = volumeScale(4 / 3 * (Math.PI * (initScale(parseFloat(d[centrality])) * initScale(parseFloat(d[centrality])) * initScale(parseFloat(d[centrality]))))); }});

                } else if (scaleType == "reverse_volume") {

                    reversed_volume_values = []             

                    scaledValues.forEach( function (d) { reversed_volume_values.push(parseFloat(4 / 3 * (Math.PI * (parseFloat(1/d) * parseFloat(1/d) * parseFloat(1/d))))); });

                    reversedVolumeScale = d3.scaleLinear()
                        .domain(d3.extent(reversed_volume_values))
                        .range(range);

                    graph.nodes.forEach( function (d) { if (isNaN(d[centrality])) { d.size = reversedVolumeScale(4 / 3 * (Math.PI * ((1 / initScale(parseFloat(0))) * (1 / initScale(parseFloat(0))) * (1 / initScale(parseFloat(0)))))); } else { d.size = reversedVolumeScale(4 / 3 * (Math.PI * ((1 / initScale(parseFloat(d[centrality]))) * (1 / initScale(parseFloat(d[centrality]))) * (1 / initScale(parseFloat(d[centrality])))))); }});

                }    
            }

            var scaleLinksLinear = d3.scaleLinear()
                .domain([d3.min(graph.links, function(d) {return d.weight; }),d3.max(graph.links, function(d) {return d.weight; })])
                .range([1,1000])
                .clamp(true);

            var scaleLinksLog = d3.scaleLog()
                .domain([Math.log(d3.min(graph.links, function(d) {return d.weight; })),Math.log(d3.max(graph.links, function(d) {return d.weight; }))])          	    
                .range([1,1000])
                .clamp(true);       

            simulation
                .force("charge", d3.forceManyBody().strength(params.chargeStrength).distanceMax(500))            
                .force("collide", d3.forceCollide().radius( function (d) { return d.size; }));

            graph.nodes.forEach(function(d) { if (typeof d.color !== 'undefined') { colorBy.push(d.color); } else { colorBy.push(1); } });

            var colorBy = Array.from(new Set(colorBy)) 

            update();

            function update() {

                node = node.data(graph.nodes, d => d.id);

                node.exit().remove();

                var newNode = node.enter().append("circle")
                        .attr('r', function(d, i) { return d.size; })      		    
                        .attr("fill", function(d) { return d.color; })
                        .attr('class', 'node')
                        .on('mouseover', function(d) {
                                
                                peak_data = params.node_data;

                                if (Number.isNaN(Number(d[peak_data[0]]))) {                                
                                    var init_value = d[peak_data[0]]                                    
                                } else if (typeof Number(d[peak_data[0]]) == 'number') { 
                                    var init_value = Number(d[peak_data[0]]).toFixed(3)
                                }
                                
                                html_line = "\""+ peak_data[0] + "\",\"" + init_value + "\"";

                                peak_data.forEach(function(p) { 

                                    if (p !== peak_data[0]) {
                                        if (Number.isNaN(Number(d[p]))) {
                                            var data_value = d[p];
                                        } else if (typeof Number(d[p]) == 'number') {
                                            var data_value = Number(d[p]).toFixed(3);
                                        }

                                        html_line = html_line + "\n\"" + p + "\",\"" + data_value + "\"";

                                    }
                                });
                                
                                displayNodeData(html_line)
                        })      		    
                        .on('dblclick', releaseNode)
                        .on('click', fade(0.1))
                        .on("mouseout", function() {
                                d3.select('#nodedataPanel').selectAll("*").remove();                                
                        })
                        .call(d3.drag()
                            .on("start", dragstarted)
                            .on("drag", dragged)
                            .on("end", dragended));

                node = node.merge(newNode);

                label = label.data(graph.nodes, d => d.id);

                label.exit().remove();

                var newLabel = label.enter().append("text")
                        .text(function (d) { if (params.displayLabel == "true") { return d.Label; } else { return d.Name; } })
                        .style("text-anchor", "middle")
                            .style("fill", "black")
                            .style("font-family", "Helvetica")
                            .style("font-size", params.node_text_size)
                        .attr('class', 'node')
                        .on('mouseover', function(d) {
                        
                                peak_data = params.node_data;

                                if (Number.isNaN(Number(d[peak_data[0]]))) {                                
                                    var init_value = d[peak_data[0]]                                    
                                } else if (typeof Number(d[peak_data[0]]) == 'number') { 
                                    var init_value = Number(d[peak_data[0]]).toFixed(3)
                                }

                                html_line = "\""+ peak_data[0] + "\",\"" + init_value + "\"";

                                peak_data.forEach(function(p) { 

                                    if (p !== peak_data[0]) {
                                        if (Number.isNaN(Number(d[p]))) {
                                            var data_value = d[p];
                                        } else if (typeof Number(d[p]) == 'number') {
                                            var data_value = Number(d[p]).toFixed(3);
                                        }

                                        html_line = html_line + "\n\"" + p + "\",\"" + data_value + "\"";

                                    }
                                });
                                
                                displayNodeData(html_line)                                
                        })
                        .on('dblclick', releaseNode)
                        .on('click', fade(0.1))      		    
                        .on("mouseout", function() {
                                d3.select('#nodedataPanel').selectAll("*").remove();                                
                        })
                        .call(d3.drag()
                            .on("start", dragstarted)
                            .on("drag", dragged)
                            .on("end", dragended));

                label = label.merge(newLabel);

                //Add no links
                link = link.data([]);

                //Remove all old links, leaving no links
                link.exit().remove();

                //Add new links
                link = link.data(graph.links);

                //Remove all old links, leaving only the new links
                link.exit().remove();

                var newLink = link.enter().append("line")
                            .attr("class", "link")
                            .attr("stroke-width", params.link_width)
                            .style("stroke", function(d) { return d.color; })
                            .on('mouseover', function(d) {
                                    
                                    if (params.displayLabel == "true") {                                                
                                        var source = d.source.Label;
                                        var target = d.target.Label;
                                    } else { 
                                        var source = d.source.Name;
                                        var target = d.target.Name;
                                    }
                                    
                                    html_line = "\"Source\",\""+ source + "\"\n\"Target\",\"" + target + "\"\n\"" + link_type_text + "\"," + d.weight.toPrecision(3)                 
                                    
                                    displayNodeData(html_line)                                    
                            })
                            .on("mouseout", function() {
                                    d3.select('#nodedataPanel').selectAll("*").remove();                                    
                            });                            

                link = link.merge(newLink);

                simulation
                    .nodes(graph.nodes)
                    .on("tick", ticked);

                simulation.force("link")
                    .links(graph.links);

                simulation.alphaTarget(0.1).restart();
            }

            function ticked() {
                link
                    .attr("x1", function(d) { return d.source.x; })
                    .attr("y1", function(d) { return d.source.y; })
                    .attr("x2", function(d) { return d.target.x; })
                    .attr("y2", function(d) { return d.target.y; });    

                node       
                    .attr("cx", function(d) { return d.x = Math.max(d3.select(this).attr("r"), Math.min(width - d3.select(this).attr("r"), d.x)); })
                    .attr("cy", function(d) { return d.y = Math.max(d3.select(this).attr("r"), Math.min(height - d3.select(this).attr("r"), d.y)); });    

                label.attr("x", function(d){ return d.x; })
                     .attr("y", function (d) {return d.y + 5; });            

            }

            var sliderInitValue = '';
            var sliderMin = '';
            var sliderMax = '';
            var sliderValue = '';

            if (params.link_type == "score") {
                sliderInitValue =  d3.min(graph.links, function(d) {return d.weight; }).toPrecision(5)
                sliderMin = scaleLinksLinear(d3.min(graph.links, function(d) {return d.weight; }))
                sliderMax = scaleLinksLinear(d3.max(graph.links, function(d) {return d.weight; }))
                sliderValue = scaleLinksLinear(d3.min(graph.links, function(d) {return d.weight; }))
            } else if (params.link_type == "pvalue") {
                sliderInitValue =  d3.max(graph.links, function(d) {return d.weight; }).toPrecision(5)
                sliderMin = scaleLinksLog(Math.log(d3.min(graph.links, function(d) {return d.weight; })))
                sliderMax = scaleLinksLog(Math.log(d3.max(graph.links, function(d) {return d.weight; })))
                sliderValue = scaleLinksLog(Math.log(d3.max(graph.links, function(d) {return d.weight; })))
            }

            d3.select('#sliderText').text(link_type_text + ' threshold: ');

            d3.select('#sliderValue').text(sliderInitValue);

            var sliderWidth = 225;
            var sliderOffSet = 45;

            var Slider = d3.sliderHorizontal()
    	    					    .min(sliderMin)
    							    .max(sliderMax)
                                    .default(sliderInitValue)
                                    .ticks(0)
                                    .handle(d3.symbol().type(d3.symbolCircle).size(150)())
    							    .step(0.0001)                        
                                    .fill('#2196f3')
    							    .width(sliderWidth - sliderOffSet)
    							    .displayValue(false)
    							    .on('onchange', value => {

      							    	if (params.link_type == "score") {
                                            var threshold = scaleLinksLinear.invert(value);
                                        } else if (params.link_type == "pvalue")  {
                                            var threshold = Math.exp(scaleLinksLog.invert(value));
                                        }

                					    d3.select('#sliderValue').text(threshold.toPrecision(5));

                                        graph.links.splice(0, graph.links.length);
                                        graphRec.links.forEach( function (d) { if (d.weight >= threshold) { graph.links.push(d); }});

                                        //Update link dictionary
                                        linkedByIndex = {} 
                                        graphRec.links.forEach( function (d) {
                                            if (d.weight >= threshold) {

                                                var source = JSON.stringify(d.source.id);
                                                var target = JSON.stringify(d.target.id);

                                                if (typeof source == 'undefined') {
                                                    source = JSON.stringify(d.source);
                                                }

                                                if (typeof target == 'undefined') {
                                                    target = JSON.stringify(d.target);
                                                }

                                                linkedByIndex[source + ',' + target] = 1;
                                                linkedByIndex[target + ',' + source] = 1;	  						         
                                            }
                                        });         

                                        update(); 
          						    });

            d3.select('#slider').selectAll("*").remove();

            d3.select('#slider')
                    .append('svg')
                    .attr('width', sliderWidth)    
                    .append('g')    
                    .attr('transform', 'translate(30,30)')
                    .call(Slider);

            if (Object.keys(params.node_size_scale).length != 0) {

                var nodeSizeDropdown = d3.select('#nodeSizeDropdown')   
                    .append('select')
                    .attr("class","nodeSizeDropdown")
                    .on('change', function() { 
                        var centrality = this.value;

                        updateNodeSize(centrality)

                        node.attr('r', function(d) { return d.size; } );  

                        simulation.force("collide", d3.forceCollide().radius( function (d) { return d.size; }));
                        simulation.alphaTarget(0.1).restart();
                    });

                nodeSizeDropdown.selectAll('option')
                    .data(Object.keys(params.node_size_scale))
                    .enter().append('option')		
                    .text(function(d) { return d; });
            } else {

                var nodeSizeDropdown = d3.select('#nodeSizeDropdown')
                    .append('select')
                    .attr("class","nodeSizeDropdown");

                nodeSizeDropdown.selectAll('option')
                    .data(['none'])
                    .enter().append('option')		
                    .text(function(d) { return d; });        
            }

            var colorDropDownValues = ['default','schemeCategory10','schemeAccent','schemeDark2','schemePaired','schemePastel1','schemePastel2','schemeSet1','schemeSet2','schemeSet3'];
            var schemeLenCount = [];

            //Get lengths of all color schemes used
            colorDropDownValues.forEach( function(value) { if (value !== 'default') { schemeLenCount.push(d3[value].length); }});

            var nodeColorDropdown = d3.select('#nodeColorDropdown')
                .append('select')
                .attr("class","nodeColorDropdown")
                .on('change', function() { 
                    var colorScheme = this.value;

                    if (colorScheme == 'default') {
                        node.attr("fill", function(d) { return d.color; })
                    } else {

                        //Slice color schemes to the minimum length across all color schemes for consistancy when switching color schemes
                        colorSchemeSliced = d3[colorScheme].slice(0, d3.min(schemeLenCount));

                        var color_palette = d3.scaleOrdinal()
                                                   .domain(colorBy)
                                                   .range(colorSchemeSliced);                                                        

                        node.attr("fill", function(d) { if (typeof d.color !== 'undefined') { return color_palette(d.color); } else { return color_palette(1); } });                        
                    }

                    simulation.alphaTarget(0.1).restart();
                });

            nodeColorDropdown.selectAll('option')
                .data(colorDropDownValues)
                .enter().append('option')		
                .text(function(d) { return d; });

            d3.select("#save")
                    .on('click', function(){

                        var options = {
                                canvg: window.canvg,
                                backgroundColor: 'white',
                                height: height+100,
                                width: width+100,
                                left: -50,
                                scale: 5/window.devicePixelRatio,
                                encoderOptions: 1,
                                ignoreMouse : true,
                                ignoreAnimation : true,
                        }

                        saveSvgAsPng(d3.select('svg#springNetwork').node(), "networkPlot.png", options);
                    })

            function dragstarted(d) {

                if (!d3.event.active) simulation.alphaTarget(0.3).restart();
                d.fx = d.x;
                d.fy = d.y;
            }

            function dragged(d) {
                d.fx = d3.event.x;
                d.fy = d3.event.y;
            }

            function dragended(d) {
                if (!d3.event.active) simulation.alphaTarget(0);

                if (params.fix_nodes == "true") {
                    d.fx = d3.event.x;
                    d.fy = d3.event.y;
                } else {
                    d.fx = null;
                    d.fy = null;
                }
            }

            function releaseNode(d) {        
                d.fx = null;
                d.fy = null;
            }

            function zoomed() {
                container.attr("transform", "translate(" + d3.event.transform.x + ", " + d3.event.transform.y + ") scale(" + d3.event.transform.k + ")");
            }

            function neighboring(a, b) {
                return linkedByIndex[a.id + ',' + b.id] || linkedByIndex[b.id + ',' + a.id] || a.id === b.id;
            }          

            function fade(opacity) {
                return d => {

                    if (toggle == 0) {

                        node.style('stroke-opacity', function (o) {
                            const nodeOpacity = neighboring(d, o) ? 1 : opacity;
                            this.setAttribute('fill-opacity', nodeOpacity);
                            return nodeOpacity;
                        });

                        label.style('stroke-opacity', function (o) {
                            const labelOpacity = neighboring(d, o) ? 1 : opacity;
                            this.setAttribute('fill-opacity', labelOpacity);
                            return labelOpacity;
                        });

                        link.style('stroke-opacity', o => (o.source === d || o.target === d ? 1 : opacity));

                        toggle = 1;
                    } else {

                        node.style('stroke-opacity', function (o) {
                            const nodeOpacity = 1;
                            this.setAttribute('fill-opacity', nodeOpacity);
                            return nodeOpacity;
                        });

                        label.style('stroke-opacity', function (o) {
                            const labelOpacity = 1;
                            this.setAttribute('fill-opacity', labelOpacity);
                            return labelOpacity;
                        });          

                        link.style('stroke-opacity', 0.6);

                        toggle = 0;
                    }
                };
            }         

            function searchNodes() {
                var term = document.getElementById('searchTerm').value;
                var selected = container.selectAll('.node').filter(function (d, i) {
                    return d.Label.toLowerCase().search(term.toLowerCase()) == -1;
                });
                selected.style('opacity', '0');
                var link = container.selectAll('.link');
                link.style('stroke-opacity', '0');
                d3.selectAll('.node').transition()
                        .duration(1000)
                        .style('opacity', '1');
                d3.selectAll('.link').transition().duration(5000).style('stroke-opacity', '0.6');
            }
            
            function displayNodeData(datasetText) {
            
                d3.select('#nodedataPanel').selectAll("*").remove();
            
  				var rows  = d3.csvParseRows(datasetText),
      			table = d3.select('#nodedataPanel').append('table')
                						.style("border-collapse", "collapse")
                						.style("border", "2px black solid");
        				
                var tablebody = table.append("tbody");
        				
                rows = tablebody
                		.selectAll("tr")
                		.data(rows)
                		.enter()
                		.append("tr");
 
 				cells = rows.selectAll("td")            		
                		.data(function(d) { return d; })
                		.enter()
                		.append("td")
                		.text(function(d) { return d; })
                        .style("border", "1px black solid")
                        .style("font-size", "20px");
			};
        }

        redraw();

        window.addEventListener("resize", redraw); 
         </script>
        